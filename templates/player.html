<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Advanced Local Stream Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="https://cdn.tailwindcss.com"></script>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.6.15/dist/hls.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js" crossorigin="anonymous"></script>


</head>

<body class="bg-zinc-900 text-zinc-200 min-h-screen">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Title -->
    <div class="flex items-center justify-between gap-4 mb-4">
      <div id="stream-title" class="text-2xl font-semibold truncate">No stream loaded</div>
      <div class="text-xs text-zinc-400">
        Mode: <span id="modeLabel" class="font-medium text-zinc-200">Normal</span>
      </div>
    </div>

    <!-- Player container -->
      <div id="playerShell" class="relative bg-black rounded-xl elev-2 overflow-hidden mb-5 w-full aspect-video min-h-[240px]">


      <!-- Three.js 360 canvas (hidden in normal mode) -->
      <canvas id="three360Canvas" class="absolute inset-0 w-full h-full hidden"></canvas>

      <!-- Video surface (full in normal mode; overlay preview in 360 mode) -->
      <div id="videoSurface" class="absolute inset-0">
        <!-- Drag bar (only used in 360 preview mode) -->
        <div id="previewDragBar"
             class="hidden absolute top-0 left-0 right-0 h-6 bg-gradient-to-b from-black/60 to-black/0 cursor-move z-20">
          <div class="px-2 text-xs text-zinc-200/90 leading-6 select-none">Preview</div>
        </div>

        <video id="video"
               class="w-full h-full object-contain bg-black"
               controls
               autoplay
               muted
               playsinline>
        </video>

        <!-- Resize handle (only used in 360 preview mode) -->
        <div id="previewResizeHandle"
             class="hidden absolute bottom-0 right-0 w-4 h-4 z-30 cursor-se-resize">
          <div class="w-full h-full bg-white/20 hover:bg-white/35 rounded-tl-md"></div>
        </div>
      </div>

      <!-- Helper overlay buttons for 360 mode -->
      <div id="hud"
           class="hidden absolute right-3 top-3 z-40 flex flex-col gap-2">
        <button class="px-3 py-2 rounded-lg bg-zinc-800/70 hover:bg-zinc-700/80 border border-white/10 text-xs"
                onclick="resetView()">
          Reset View
        </button>
      </div>
    </div>

    <!-- Controls -->
    <div class="bg-zinc-800 p-4 rounded-xl border border-white/10 mb-6">
      <div class="flex flex-wrap gap-3 items-center">
        <input id="streamUrl"
               placeholder="Enter any stream URL"
               class="px-3 py-2 rounded-lg bg-zinc-700 text-zinc-200 w-[26rem] max-w-full outline-none border border-white/10 focus:border-white/20">

        <button onclick="loadStream()"
                class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg">
          Load Stream
        </button>

        <select id="qualitySelector"
                onchange="switchQuality()"
                class="px-3 py-2 rounded-lg bg-zinc-700 text-zinc-200 border border-white/10">
        </select>

        <button id="toggle360Btn"
                onclick="toggle360Mode()"
                class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
          Toggle 360 Mode (V)
        </button>

        <button onclick="addToFavorites()"
                class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg">
          Add to Favorites
        </button>
      </div>

      <!-- 360 controls -->
      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-zinc-900/40 rounded-xl p-3 border border-white/10">
          <div class="text-sm font-semibold mb-2">360 View Controls</div>

          <div class="flex flex-wrap gap-2 items-center mb-3">
            <div class="text-xs text-zinc-400 mr-1">FOV presets:</div>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="setFovPreset('wide')">Wide (100°)</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="setFovPreset('normal')">Normal (75°)</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="setFovPreset('tele')">Tele (55°)</button>
          </div>

          <div class="flex items-center gap-3">
            <div class="text-xs text-zinc-400 w-16">FOV</div>
            <input id="fovSlider" type="range" min="40" max="120" value="75"
                   class="w-full"
                   oninput="setFovFromSlider(this.value)">
            <div id="fovValue" class="text-xs w-10 text-right">75</div>
          </div>

          <div class="mt-3 flex flex-wrap gap-2 items-center">
            <div class="text-xs text-zinc-400 mr-1">Pan:</div>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="nudgePan(0, -6)">Up</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="nudgePan(-6, 0)">Left</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="nudgePan(6, 0)">Right</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="nudgePan(0, 6)">Down</button>

            <div class="ml-2 text-xs text-zinc-400">Zoom:</div>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="adjustFov(-3)">+</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="adjustFov(3)">-</button>
          </div>

          <div class="mt-2 text-xs text-zinc-500">
            Drag to pan. Wheel to zoom. Arrow keys pan. +/- adjusts FOV.
          </div>
        </div>

        <div class="bg-zinc-900/40 rounded-xl p-3 border border-white/10">
          <div class="text-sm font-semibold mb-2">360 Preview Window</div>

          <div class="flex flex-wrap gap-2 items-center mb-3">
            <button id="togglePreviewBtn"
                    class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="togglePreview()">
              Toggle Preview (P)
            </button>

            <div class="text-xs text-zinc-400 ml-2">Size presets:</div>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="applyPreviewPreset('small')">Small (1/10)</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="applyPreviewPreset('medium')">Medium (1/8)</button>
            <button class="px-3 py-2 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-xs"
                    onclick="applyPreviewPreset('large')">Large (1/6)</button>
          </div>

          <div class="flex items-center gap-3 mb-3">
            <div class="text-xs text-zinc-400 w-16">Opacity</div>
            <input id="previewOpacity" type="range" min="10" max="100" value="85"
                   class="w-full"
                   oninput="setPreviewOpacity(this.value)">
            <div id="previewOpacityValue" class="text-xs w-12 text-right">85%</div>
          </div>

          <div class="flex flex-wrap gap-3 items-center">
            <label class="flex items-center gap-2 text-xs text-zinc-300">
              <input id="previewBorderToggle" type="checkbox" class="accent-zinc-200"
                     onchange="togglePreviewBorder(this.checked)">
              2px frame
            </label>

            <label class="flex items-center gap-2 text-xs text-zinc-300">
              Frame color
              <input id="previewBorderColor" type="color" value="#00e5ff"
                     onchange="setPreviewBorderColor(this.value)">
            </label>

            <div class="text-xs text-zinc-500">
              Drag via top bar. Resize via corner.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Favorites -->
    <div class="bg-zinc-800 p-4 rounded-xl border border-white/10">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-xl">Favorites</h3>
        <button onclick="clearAllFavorites()" 
            class="px-3 py-1 text-sm bg-red-600 hover:bg-red-700 rounded">
      Clear All
    </button>
  </div>
  <ul id="favorites-list" class="space-y-2"></ul>
</div>

  <script src="/static/js/app.js"></script>
  <script src="/static/js/player.js"></script>
  <script src="/static/js/shortcuts.js"></script>
  <script src="/static/js/favorites.js"></script>

  <style>
    .elev-2 { box-shadow: 0 10px 28px rgba(0,0,0,0.45); }
  </style>
</body>
</html>

